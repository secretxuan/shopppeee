# ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å®¢æˆ·ç«¯å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Web æµè§ˆå™¨â”‚  â”‚ ç§»åŠ¨ App  â”‚  â”‚ å°ç¨‹åº    â”‚  â”‚ ç¬¬ä¸‰æ–¹API â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ HTTP/HTTPS + WebSocket
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åå‘ä»£ç†å±‚ï¼ˆå¯é€‰ï¼‰                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Nginx / Traefik / Kong                                â”‚ â”‚
â”‚  â”‚  - è´Ÿè½½å‡è¡¡                                             â”‚ â”‚
â”‚  â”‚  - SSL/TLS ç»ˆæ­¢                                        â”‚ â”‚
â”‚  â”‚  - é™æ€èµ„æºç¼“å­˜                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨å±‚ï¼ˆGin æ¡†æ¶ï¼‰                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  è·¯ç”±å±‚ (Router)                                        â”‚ â”‚
â”‚  â”‚  â””â”€ /api/v1/auth      - è®¤è¯è·¯ç”±                       â”‚ â”‚
â”‚  â”‚  â””â”€ /api/v1/products  - å•†å“è·¯ç”±                       â”‚ â”‚
â”‚  â”‚  â””â”€ /api/v1/orders    - è®¢å•è·¯ç”±                       â”‚ â”‚
â”‚  â”‚  â””â”€ /ws               - WebSocket                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ä¸­é—´ä»¶å±‚ (Middleware)                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ CORS ä¸­é—´ä»¶       - è·¨åŸŸå¤„ç†                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ Auth ä¸­é—´ä»¶       - JWT è®¤è¯                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ RateLimit ä¸­é—´ä»¶  - é™æµä¿æŠ¤                       â”‚ â”‚
â”‚  â”‚  â””â”€ Logger ä¸­é—´ä»¶     - è¯·æ±‚æ—¥å¿—                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å¤„ç†å™¨å±‚ (Handler)                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ AuthHandler       - è®¤è¯å¤„ç†å™¨                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ ProductHandler    - å•†å“å¤„ç†å™¨                     â”‚ â”‚
â”‚  â”‚  â”œâ”€ OrderHandler      - è®¢å•å¤„ç†å™¨                     â”‚ â”‚
â”‚  â”‚  â””â”€ WebSocketHandler  - WebSocket å¤„ç†å™¨               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æœåŠ¡å±‚ (Service) - ä¸šåŠ¡é€»è¾‘                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ AuthService       - è®¤è¯æœåŠ¡                       â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€ Register, Login, GetUserInfo                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ ProductService    - å•†å“æœåŠ¡                       â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€ BatchUpdate, GetList, Search                  â”‚ â”‚
â”‚  â”‚  â””â”€ OrderService      - è®¢å•æœåŠ¡                       â”‚ â”‚
â”‚  â”‚      â””â”€ Create, Pay, Ship, Complete                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  æ•°æ®è®¿é—®å±‚ (Repository/GORM)                           â”‚ â”‚
â”‚  â”‚  â””â”€ æ•°æ®æ¨¡å‹ (Models)                                  â”‚ â”‚
â”‚  â”‚      â”œâ”€ User, Product, Order, Cart, etc.              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
        â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®åº“å±‚     â”‚  â”‚   ç¼“å­˜å±‚      â”‚
â”‚ PostgreSQL   â”‚  â”‚    Redis      â”‚
â”‚  - ä¸»æ•°æ®å­˜å‚¨ â”‚  â”‚  - ä¼šè¯ç¼“å­˜   â”‚
â”‚  - äº‹åŠ¡æ”¯æŒ   â”‚  â”‚  - é™æµè®¡æ•°   â”‚
â”‚  - å…³ç³»æ¨¡å‹   â”‚  â”‚  - çƒ­ç‚¹æ•°æ®   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ è¯·æ±‚å¤„ç†æµç¨‹

### HTTP API è¯·æ±‚æµç¨‹

```
å®¢æˆ·ç«¯è¯·æ±‚
    â†“
Nginx (å¯é€‰)
    â†“
Gin è·¯ç”±åŒ¹é…
    â†“
CORS ä¸­é—´ä»¶ â”€â”€â”€â”€â†’ è®¾ç½®è·¨åŸŸå¤´
    â†“
é™æµä¸­é—´ä»¶ â”€â”€â”€â”€â†’ Redis æ£€æŸ¥é¢‘ç‡ â”€â”€â†’ è¶…é™è¿”å› 429
    â†“
è®¤è¯ä¸­é—´ä»¶ â”€â”€â”€â”€â†’ éªŒè¯ JWT Token â”€â”€â†’ å¤±è´¥è¿”å› 401
    â†“                â”‚
Handler å¤„ç†       â”œâ”€â†’ è§£æ Token
    â†“              â””â”€â†’ æ³¨å…¥ç”¨æˆ·ä¿¡æ¯åˆ° Context
Service ä¸šåŠ¡é€»è¾‘
    â†“
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
â”‚ ç¼“å­˜ï¼Ÿ  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”œâ”€â†’ å‘½ä¸­ â”€â”€â†’ è¿”å›ç¼“å­˜æ•°æ®
    â†“
    â””â”€â†’ æœªå‘½ä¸­
         â†“
    æ•°æ®åº“æŸ¥è¯¢
         â†“
    å¼‚æ­¥å†™å…¥ç¼“å­˜
         â†“
    è¿”å›å“åº” (JSON)
```

### WebSocket è¿æ¥æµç¨‹

```
å®¢æˆ·ç«¯å‘èµ· WebSocket è¿æ¥
    â†“
HTTP å‡çº§è¯·æ±‚
    â†“
JWT è®¤è¯ä¸­é—´ä»¶éªŒè¯ Token
    â†“
Upgrade åˆ° WebSocket
    â†“
åˆ›å»º Client å®ä¾‹
    â†“
æ³¨å†Œåˆ° Hub â”€â”€â”€â”€â†’ userClients[userID] = client
    â†“
å¯åŠ¨åç¨‹:
    â”œâ”€â†’ readPump  (è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯)
    â””â”€â†’ writePump (å‘é€æœåŠ¡ç«¯æ¶ˆæ¯)
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¶ˆæ¯å¤„ç†å¾ªç¯    â”‚
â”‚  - ping/pong    â”‚
â”‚  - å¿ƒè·³æ£€æµ‹      â”‚
â”‚  - ä¸šåŠ¡æ¶ˆæ¯      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§± åˆ†å±‚æ¶æ„è®¾è®¡

### 1. è·¯ç”±å±‚ (Router)

**èŒè´£**: URL åˆ° Handler çš„æ˜ å°„

```go
router.go
â”œâ”€ /api/v1/auth       â†’ AuthHandler
â”œâ”€ /api/v1/products   â†’ ProductHandler
â”œâ”€ /api/v1/orders     â†’ OrderHandler
â””â”€ /ws                â†’ WebSocketHandler
```

### 2. ä¸­é—´ä»¶å±‚ (Middleware)

**èŒè´£**: æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆAOPï¼‰

| ä¸­é—´ä»¶ | åŠŸèƒ½ | ä½ç½® |
|--------|------|------|
| CORS | è·¨åŸŸå¤„ç† | å…¨å±€ |
| Auth | JWT è®¤è¯ | éœ€è¦ç™»å½•çš„è·¯ç”± |
| RateLimit | é™æµä¿æŠ¤ | å…¬å¼€ API |
| Logger | è¯·æ±‚æ—¥å¿— | å…¨å±€ |
| Admin | ç®¡ç†å‘˜æƒé™ | ç®¡ç†æ¥å£ |

### 3. å¤„ç†å™¨å±‚ (Handler)

**èŒè´£**: è¯·æ±‚è§£æã€å“åº”å°è£…

```go
AuthHandler
â”œâ”€ Register()     - è§£ææ³¨å†Œè¯·æ±‚
â”œâ”€ Login()        - è§£æç™»å½•è¯·æ±‚
â””â”€ GetUserInfo()  - è·å–ç”¨æˆ·ä¿¡æ¯
    â†“
è°ƒç”¨ Service å±‚
```

### 4. æœåŠ¡å±‚ (Service)

**èŒè´£**: ä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡ç®¡ç†

```go
AuthService
â”œâ”€ Register(req)
â”‚   â”œâ”€ éªŒè¯ç”¨æˆ·å/é‚®ç®±å”¯ä¸€æ€§
â”‚   â”œâ”€ åˆ›å»ºç”¨æˆ·ï¼ˆäº‹åŠ¡ï¼‰
â”‚   â”œâ”€ åˆ›å»ºè´­ç‰©è½¦ï¼ˆäº‹åŠ¡ï¼‰
â”‚   â””â”€ è¿”å›ç”¨æˆ·å¯¹è±¡
â”‚
â””â”€ Login(req)
    â”œâ”€ æŸ¥è¯¢ç”¨æˆ·
    â”œâ”€ éªŒè¯å¯†ç 
    â”œâ”€ ç”Ÿæˆ JWT Token
    â”œâ”€ ç¼“å­˜ä¼šè¯åˆ° Redis
    â””â”€ è¿”å› Token + ç”¨æˆ·ä¿¡æ¯
```

### 5. æ•°æ®è®¿é—®å±‚ (Repository/GORM)

**èŒè´£**: æ•°æ®æŒä¹…åŒ–

```go
// ä½¿ç”¨ GORM ç›´æ¥æ“ä½œ
db.Create(&user)
db.Where("username = ?", username).First(&user)
db.Preload("Category").Find(&products)
```

## ğŸ”€ å¹¶å‘å¤„ç†æ¶æ„

### åç¨‹æ± æ¨¡å¼ (Worker Pool)

```
ä»»åŠ¡é˜Ÿåˆ— (Channel)
    â”‚
    â”œâ”€â†’ Worker 1 â”€â”€â”
    â”œâ”€â†’ Worker 2 â”€â”€â”¤
    â”œâ”€â†’ Worker 3 â”€â”€â”¼â”€â†’ å¹¶å‘å¤„ç†
    â”œâ”€â†’ Worker 4 â”€â”€â”¤
    â””â”€â†’ Worker 5 â”€â”€â”˜
         â”‚
         â†“
    ç»“æœæ”¶é›† (Channel)
         â”‚
         â†“
    ç­‰å¾…æ‰€æœ‰å®Œæˆ (WaitGroup)
         â”‚
         â†“
    è¿”å›ç»“æœ
```

**ä»£ç ç¤ºä¾‹**:
```go
const workerCount = 5
jobs := make(chan Job, 100)
results := make(chan Result, 100)

// å¯åŠ¨ worker åç¨‹æ± 
var wg sync.WaitGroup
for i := 0; i < workerCount; i++ {
    wg.Add(1)
    go func() {
        defer wg.Done()
        for job := range jobs {
            result := processJob(job)
            results <- result
        }
    }()
}

// å‘é€ä»»åŠ¡
for _, job := range allJobs {
    jobs <- job
}
close(jobs)

// ç­‰å¾…å®Œæˆ
wg.Wait()
close(results)
```

## ğŸ” å®‰å…¨æ¶æ„

### è®¤è¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç™»å½•  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
éªŒè¯ç”¨æˆ·å/å¯†ç 
     â”‚
     â–¼
ç”Ÿæˆ JWT Token
     â”‚
     â”œâ”€â†’ Payload: {user_id, username, role}
     â”œâ”€â†’ Secret: JWT_SECRET
     â””â”€â†’ Expire: 24å°æ—¶
     â”‚
     â–¼
è¿”å› Token ç»™å®¢æˆ·ç«¯
     â”‚
     â–¼
å®¢æˆ·ç«¯ä¿å­˜ Token (localStorage/Cookie)
     â”‚
     â–¼
åç»­è¯·æ±‚æºå¸¦ Token
     â”‚
Authorization: Bearer <token>
     â”‚
     â–¼
æœåŠ¡ç«¯éªŒè¯ Token
     â”‚
     â”œâ”€â†’ ç­¾åéªŒè¯
     â”œâ”€â†’ è¿‡æœŸæ£€æŸ¥
     â””â”€â†’ è§£æç”¨æˆ·ä¿¡æ¯
     â”‚
     â–¼
æ³¨å…¥åˆ° Context
     â”‚
c.Set("user_id", claims.UserID)
```

### æƒé™æ§åˆ¶

```
è¯·æ±‚ â†’ Authä¸­é—´ä»¶ â†’ éªŒè¯ Token â†’ è§£æè§’è‰²
                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                    â”‚           â”‚
                role=user   role=admin
                    â”‚           â”‚
                    â–¼           â–¼
                æ™®é€šæ¥å£    ç®¡ç†æ¥å£
                              â”‚
                          Adminä¸­é—´ä»¶
                              â”‚
                          éªŒè¯ role
                              â”‚
                        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                        â”‚           â”‚
                     æ˜¯ admin    é admin
                        â”‚           â”‚
                        â–¼           â–¼
                    å…è®¸è®¿é—®    è¿”å› 403
```

## ğŸ’¾ ç¼“å­˜æ¶æ„

### ç¼“å­˜ç­–ç•¥

```
è¯·æ±‚å•†å“è¯¦æƒ…
    â”‚
    â–¼
ç”Ÿæˆç¼“å­˜ Key: "product:{id}"
    â”‚
    â–¼
Redis GET
    â”‚
â”Œâ”€â”€â”€â”´â”€â”€â”€â”
â”‚ å‘½ä¸­ï¼Ÿ â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”œâ”€â†’ æ˜¯ â”€â”€â†’ è¿”å›ç¼“å­˜æ•°æ®
    â”‚
    â””â”€â†’ å¦
         â”‚
         â–¼
    æŸ¥è¯¢æ•°æ®åº“
         â”‚
         â–¼
    å¼‚æ­¥å†™å…¥ Redis
         â”‚
    SET product:{id} = data
    EXPIRE = 1å°æ—¶
         â”‚
         â–¼
    è¿”å›æ•°æ®
```

### ç¼“å­˜å±‚æ¬¡

| å±‚çº§ | å­˜å‚¨ | è¿‡æœŸæ—¶é—´ | ç”¨é€” |
|------|------|----------|------|
| **L1** | åº”ç”¨å†…å­˜ | 5åˆ†é’Ÿ | çƒ­ç‚¹æ•°æ® |
| **L2** | Redis | 1å°æ—¶ | å•†å“è¯¦æƒ… |
| **L3** | PostgreSQL | æ°¸ä¹… | æŒä¹…åŒ– |

## ğŸ“¡ WebSocket æ¶æ„

### Hub æ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              WebSocket Hub              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  clients: map[*Client]bool        â”‚  â”‚
â”‚  â”‚  userClients: map[uint]*Client    â”‚  â”‚
â”‚  â”‚  broadcast: chan []byte           â”‚  â”‚
â”‚  â”‚  register: chan *Client           â”‚  â”‚
â”‚  â”‚  unregister: chan *Client         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚                       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚         â–¼        â–¼        â–¼             â”‚
â”‚    Client1   Client2  Client3           â”‚
â”‚     (User1)  (User2)  (User3)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚        â”‚        â”‚
         â–¼        â–¼        â–¼
    æµè§ˆå™¨1   ç§»åŠ¨App   å°ç¨‹åº
```

### æ¶ˆæ¯æµ

```
ä¸šåŠ¡äº‹ä»¶ (è®¢å•çŠ¶æ€å˜æ›´)
    â”‚
    â–¼
è°ƒç”¨ NotifyOrderStatus(userID, orderID, status)
    â”‚
    â–¼
æ„å»º Message å¯¹è±¡
    â”‚
{
  "type": "order",
  "content": {...},
  "user_id": 123,
  "time": 1702886400
}
    â”‚
    â–¼
Hub.SendToUser(userID, message)
    â”‚
    â–¼
æŸ¥æ‰¾ userClients[userID]
    â”‚
    â”œâ”€â†’ ä¸å­˜åœ¨ â”€â”€â†’ ç”¨æˆ·ç¦»çº¿ï¼Œè·³è¿‡
    â”‚
    â””â”€â†’ å­˜åœ¨
         â”‚
         â–¼
    å‘é€åˆ° client.send (Channel)
         â”‚
         â–¼
    writePump åç¨‹æ¥æ”¶
         â”‚
         â–¼
    WebSocket å‘é€
         â”‚
         â–¼
    å®¢æˆ·ç«¯æ¥æ”¶æ¶ˆæ¯
```

## ğŸ—„ï¸ æ•°æ®åº“æ¶æ„

### ä¸»ä»æ¶æ„ï¼ˆå¯é€‰ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Master DB   â”‚ â† å†™æ“ä½œ
â”‚ (ä¸»åº“)        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
  å¤åˆ¶  â”‚
       â”‚
    â”Œâ”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼      â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Slave1 â”‚â”‚ Slave2 â”‚â”‚ Slave3 â”‚ â† è¯»æ“ä½œ
â”‚(ä»åº“1) â”‚â”‚(ä»åº“2) â”‚â”‚(ä»åº“3) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†åº“åˆ†è¡¨ï¼ˆå¯æ‰©å±•ï¼‰

```
ç”¨æˆ·è¯·æ±‚ (userID = 12345)
    â”‚
    â–¼
è®¡ç®—åˆ†ç‰‡: userID % 10 = 5
    â”‚
    â–¼
è·¯ç”±åˆ°: orders_5 è¡¨
    â”‚
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  shoppee_db    â”‚
â”‚  â”œâ”€ orders_0   â”‚
â”‚  â”œâ”€ orders_1   â”‚
â”‚  â”œâ”€ ...        â”‚
â”‚  â””â”€ orders_9   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ éƒ¨ç½²æ¶æ„

### Docker Compose (å•æœº)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Docker Host                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Docker Network (Bridge)      â”‚  â”‚
â”‚  â”‚                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚
â”‚  â”‚  â”‚ PostgreSQL â”‚              â”‚  â”‚
â”‚  â”‚  â”‚  :5432     â”‚              â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚
â”‚  â”‚         â–²                     â”‚  â”‚
â”‚  â”‚         â”‚                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”             â”‚  â”‚
â”‚  â”‚  â”‚  Go App     â”‚             â”‚  â”‚
â”‚  â”‚  â”‚  :8080      â”‚             â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜             â”‚  â”‚
â”‚  â”‚         â”‚                     â”‚  â”‚
â”‚  â”‚         â–¼                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚
â”‚  â”‚  â”‚   Redis    â”‚              â”‚  â”‚
â”‚  â”‚  â”‚   :6379    â”‚              â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ ç«¯å£æ˜ å°„
    8080:8080
```

### Kubernetes (é›†ç¾¤)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Kubernetes Cluster               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Ingress (nginx)                     â”‚  â”‚
â”‚  â”‚  - SSL/TLS Termination               â”‚  â”‚
â”‚  â”‚  - Load Balancing                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                              â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚      â–¼                â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Pod 1  â”‚      â”‚ Pod 2  â”‚ (3 Replicas)  â”‚
â”‚  â”‚ Go App â”‚      â”‚ Go App â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜               â”‚
â”‚       â”‚               â”‚                    â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚               â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  StatefulSet        â”‚                  â”‚
â”‚  â”‚  â”œâ”€ PostgreSQL Pod  â”‚                  â”‚
â”‚  â”‚  â””â”€ Redis Pod       â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                            â”‚
â”‚  Volumes: PersistentVolumeClaim            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š ç›‘æ§æ¶æ„ï¼ˆæ‰©å±•ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Go App      â”‚
â”‚  â””â”€ /metricsâ”‚ â† Prometheus æ ¼å¼
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prometheus  â”‚ â† æŒ‡æ ‡æ”¶é›†
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Grafana    â”‚ â† å¯è§†åŒ–å±•ç¤º
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ¶æ„è®¾è®¡åŸåˆ™

### SOLID åŸåˆ™

- **S** - å•ä¸€èŒè´£ï¼šæ¯ä¸ªæ¨¡å—åªåšä¸€ä»¶äº‹
- **O** - å¼€é—­åŸåˆ™ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
- **L** - é‡Œæ°æ›¿æ¢ï¼šæ¥å£å¯æ›¿æ¢å®ç°
- **I** - æ¥å£éš”ç¦»ï¼šå°è€Œç²¾çš„æ¥å£
- **D** - ä¾èµ–å€’ç½®ï¼šä¾èµ–æŠ½è±¡è€Œéå…·ä½“

### Go æœ€ä½³å®è·µ

- âœ… æ¥å—æ¥å£ï¼Œè¿”å›ç»“æ„ä½“
- âœ… ä½¿ç”¨ Context ä¼ é€’è¯·æ±‚ä¸Šä¸‹æ–‡
- âœ… é€šè¿‡ Channel é€šä¿¡è€Œéå…±äº«å†…å­˜
- âœ… æ˜¾å¼é”™è¯¯å¤„ç†
- âœ… defer ç®¡ç†èµ„æº

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

1. **åº”ç”¨å±‚**: åç¨‹æ± ã€è¿æ¥æ± 
2. **ç¼“å­˜å±‚**: Redis å¤šçº§ç¼“å­˜
3. **æ•°æ®åº“å±‚**: ç´¢å¼•ä¼˜åŒ–ã€æ‰¹é‡æ“ä½œ
4. **ç½‘ç»œå±‚**: HTTP/2ã€è¿æ¥å¤ç”¨
5. **éƒ¨ç½²å±‚**: å®¹å™¨åŒ–ã€è´Ÿè½½å‡è¡¡

---

æœ¬æ¶æ„æ–‡æ¡£è¯¦ç»†è¯´æ˜äº† Shoppee ç³»ç»Ÿçš„å„å±‚è®¾è®¡å’Œäº¤äº’æµç¨‹ï¼Œä¸ºç†è§£å’Œæ‰©å±•ç³»ç»Ÿæä¾›å‚è€ƒã€‚
